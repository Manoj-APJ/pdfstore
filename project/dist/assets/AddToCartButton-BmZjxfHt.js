import{r as d,j as a,s as u,b as l,S as p}from"./index-CYlx8I9C.js";import{C as m}from"./credit-card-CZNbJm0z.js";async function y(r){const t=await(await fetch("https://borgcmuqutrcfwioexfs.supabase.co/functions/v1/create-razorpay-order",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJvcmdjbXVxdXRyY2Z3aW9leGZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzUwMjAyMjYsImV4cCI6MjA1MDU5NjIyNn0.sw5hg7_BZPjRZH8sGaVtmQJG-Q1hEk9RlLulyD3uPkU"},body:JSON.stringify({pdfId:r.id})})).json();if(t.error)throw new Error(t.error);return t}function h(){return new Promise(r=>{const e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",e.onload=()=>r(!0),e.onerror=()=>r(!1),document.body.appendChild(e)})}function j({pdf:r}){const[e,t]=d.useState(!1),n=async()=>{try{t(!0);const{data:{user:o}}=await u.auth.getUser();if(!o){window.location.href="/login";return}if(!await h())throw new Error("Razorpay SDK failed to load");const s=await y(r),i={key:"your_razorpay_key_id",amount:s.amount,currency:s.currency,name:"PDF Store",description:`Purchase ${r.title}`,order_id:s.id,handler:function(c){console.log("Payment successful:",c)},prefill:{email:o.email},theme:{color:"#4F46E5"}};new window.Razorpay(i).open()}catch(o){console.error("Buy now error:",o),alert("Failed to process purchase. Please try again.")}finally{t(!1)}};return a.jsxs("button",{onClick:n,disabled:e,className:"w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:bg-green-400",children:[a.jsx(m,{className:"h-5 w-5 mr-2"}),e?"Processing...":"Buy Now"]})}function x({pdf:r}){const e=l(n=>n.addToCart),t=()=>{e({pdf:r,quantity:1})};return a.jsxs("button",{onClick:t,className:"w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700",children:[a.jsx(p,{className:"h-5 w-5 mr-2"}),"Add to Cart"]})}export{x as A,j as B};
